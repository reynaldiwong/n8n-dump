{"createdAt":"2025-06-24T08:23:07.449Z","updatedAt":"2025-06-26T14:36:30.000Z","id":"NlErVy3zZObte5Tl","name":"DONE - Food Calories","active":false,"isArchived":false,"nodes":[{"parameters":{"updates":["message"],"additionalFields":{}},"type":"n8n-nodes-base.telegramTrigger","typeVersion":1.2,"position":[-360,-140],"id":"ef95cb40-bf8f-4bd5-a6ec-5f34f75d3dd7","name":"Telegram Trigger","webhookId":"e7a13130-6ecd-42d8-9f57-a0a80d60c223","credentials":{"telegramApi":{"id":"mqjjEBXk8igsBbUR","name":"Jarvis Bot"}}},{"parameters":{"resource":"file","fileId":"={{ $json.message.photo[$json.message.photo.length -1].file_id }}"},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[60,-140],"id":"84805097-02bb-4459-b3da-01df49df14f3","name":"Telegram","webhookId":"2d6af281-b434-466a-bd95-97a6e228db1e","credentials":{"telegramApi":{"id":"mqjjEBXk8igsBbUR","name":"Jarvis Bot"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"34b8c764-c246-4987-b8b4-58ce547f79a6","leftValue":"={{ $json.message.photo }}","rightValue":"","operator":{"type":"array","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-180,-140],"id":"aa818730-0e39-4666-8102-e276228fa29b","name":"If"},{"parameters":{"chatId":"={{ $('Telegram Trigger').item.json.message.chat.id }}","text":"Tolong kirimkan foto makanan.","additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[-180,60],"id":"11684868-c0cf-45a2-945d-83e3aad0e96c","name":"Telegram1","webhookId":"054ff362-c57d-4000-a5b5-8dbcea0fe89f","credentials":{"telegramApi":{"id":"mqjjEBXk8igsBbUR","name":"Jarvis Bot"}}},{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"chatgpt-4o-latest","mode":"list","cachedResultName":"CHATGPT-4O-LATEST"},"text":"**Input:**\n\n- One or more food photographs taken or uploaded by the user.\n\n**Process:**\n\n1. Identify the food items in the photo using AI.\n2. Estimate portion size visually.\n3. Calculate total calorie value using a reliable food composition database.\n4. Provide a nutrition breakdown, including:\n    - Protein\n    - Karbohidrat\n    - Lemak\n    - Vitamin dan mineral (jika tersedia)\n5. Generate a simple, clear health tip or dietary recommendation.\n6. Optionally include a weekly or recent intake trend summary.\n\n**Output Format:**\n\n- A single clean JSON object\n- All fields contain plain string values in Bahasa Indonesia\n- No emojis, no Telegram formatting, no additional explanation or text outside of the JSON\n\n**Example Output:**\n\n{\n  \"judul\": \"Laporan Nutrisi\",\n  \"makanan_terdeteksi\": \"Ayam panggang, nasi putih, brokoli tumis\",\n  \"perkiraan_porsi\": \"Sekitar 350 gram\",\n  \"kalori_total\": \"520 kkal\",\n  \"nutrisi\": {\n    \"protein\": \"38 gram\",\n    \"karbohidrat\": \"45 gram\",\n    \"lemak\": \"18 gram\",\n    \"vitamin_dan_mineral\": \"Vitamin A, Vitamin C, Zat besi\"\n  },\n  \"saran_kesehatan\": \"Kurangi penggunaan minyak berlebih untuk menjaga asupan lemak tetap seimbang.\",\n  \"tren_mingguan\": \"Rata-rata asupan kalori Anda minggu ini berada dalam kisaran yang dianjurkan.\"\n}\n\n**Constraints:**\n\n- All text must be grammatically correct and natural in Bahasa Indonesia\n- Responses must be concise and clearly understandable\n- Only return the JSON object â€” no extra text","inputType":"base64","options":{"detail":"high"}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[380,-140],"id":"0a11b2ea-b5ef-47ce-8792-15e4f4dcf133","name":"OpenAI","credentials":{"openAiApi":{"id":"lHwdfRlL2uaw5819","name":"OpenAi account"}}},{"parameters":{"operation":"resize","resizeOption":"onlyIfSmaller","options":{}},"type":"n8n-nodes-base.editImage","typeVersion":1,"position":[220,-140],"id":"feaa828f-fa31-43e2-9948-34b5ea279a30","name":"Edit Image"},{"parameters":{"jsCode":"return $input.all().map(item => {\n  // Assume the input string is stored in item.json.text\n  try {\n    const parsed = JSON.parse($input.first().json.content);\n    return { json: parsed };\n  } catch (error) {\n    return {\n      json: {\n        error: 'Invalid JSON format',\n        message: error.message,\n        original: item.json.text\n      }\n    };\n  }\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[600,-140],"id":"bde3fc42-c73d-4ac8-a94b-8d8af25b1e18","name":"Code"},{"parameters":{"jsCode":"return $input.all().map(item => {\n  const data = item.json;\n\n  const message = `ðŸ“Š *${data.judul}*\\n\\n` +\n    `ðŸ½ï¸ *Makanan Terdeteksi:* ${data.makanan_terdeteksi}\\n` +\n    `âš–ï¸ *Perkiraan Porsi:* ${data.perkiraan_porsi}\\n` +\n    `ðŸ”¥ *Kalori Total:* ${data.kalori_total}\\n\\n` +\n    `ðŸ¥© *Nutrisi:*\\n` +\n    `- Protein: ${data.nutrisi?.protein}\\n` +\n    `- Karbohidrat: ${data.nutrisi?.karbohidrat}\\n` +\n    `- Lemak: ${data.nutrisi?.lemak}\\n` +\n    `- Vitamin & Mineral: ${data.nutrisi?.vitamin_dan_mineral}\\n\\n` +\n    `ðŸ’¡ *Saran Kesehatan:*\\n${data.saran_kesehatan}\\n\\n` +\n    `ðŸ“ˆ *Tren Mingguan:*\\n${data.tren_mingguan}`;\n\n  return {\n    json: {\n      message // ready for Telegram Send Message node\n    }\n  };\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[780,-140],"id":"c3c14bb3-4249-44bd-ae9f-712d490d5907","name":"Code1"},{"parameters":{"jsCode":"return $('Code').all().map(item => {\n  // Collect per-day values\n  const protein = [];\n  const karbohidrat = [];\n  const lemak = [];\n\n  for (const i of $('Code').all()) {\n    const n = i.json.nutrisi || {};\n    protein.push(parseInt(n.protein) || 0);\n    karbohidrat.push(parseInt(n.karbohidrat) || 0);\n    lemak.push(parseInt(n.lemak) || 0);\n  }\n\nreturn {\n    json: {\n      chart: {\n        type: \"pie\",\n        data: {\n          labels: [\"Protein\", \"Karbohidrat\", \"Lemak\"],\n          datasets: [{\n            data: [protein, karbohidrat, lemak],\n            backgroundColor: [\"#36A2EB\", \"#FFCE56\", \"#FF6384\"]\n          }]\n        },\n        options: {\n          plugins: {\n            title: {\n              display: true,\n              text: $input.first().json.judul || \"Komposisi Nutrisi\"\n            }\n          }\n        }\n      }\n    }\n  };\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1540,-140],"id":"1f621986-f769-4d7f-9b45-d601eb2c02b7","name":"Code2"},{"parameters":{"options":{"timezone":"Asia/Jakarta"}},"type":"n8n-nodes-base.dateTime","typeVersion":2,"position":[960,-140],"id":"8dc1bf1d-0190-44e6-adfa-b718f6f23bc0","name":"Date & Time"},{"parameters":{"operation":"formatDate","date":"={{ $json.currentDate }}","format":"custom","customFormat":"dd MMMM yyyy","options":{}},"type":"n8n-nodes-base.dateTime","typeVersion":2,"position":[1140,-140],"id":"0c1b4a11-1897-4b4c-bf80-3bdcef511043","name":"Date & Time1"},{"parameters":{"assignments":{"assignments":[{"id":"b08d773a-edd1-46bc-b5df-1ae6231429fd","name":"judul","value":"=Nutrition Graph (gram) | {{ $json.formattedDate }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1360,-140],"id":"ff3326c0-0ee8-4e19-9bdb-4a72c20f4a2c","name":"Edit Fields"},{"parameters":{"method":"POST","url":"https://quickchart.io/chart/create","sendBody":true,"specifyBody":"json","jsonBody":"={{ $json.toJsonString() }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1720,-140],"id":"b67c7463-44d9-42e2-80f4-ed89434732d5","name":"HTTP Request"},{"parameters":{"chatId":"={{ $('Telegram Trigger').item.json.message.chat.id }}","text":"={{ $('Code1').item.json.message }}","additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[1940,-140],"id":"f95d5ac6-8559-4fd2-b8c0-e2a84b1baedd","name":"Telegram2","webhookId":"d6e3cf19-b6f4-4d0b-993e-2b579f7093a4","credentials":{"telegramApi":{"id":"mqjjEBXk8igsBbUR","name":"Jarvis Bot"}}},{"parameters":{"operation":"sendPhoto","chatId":"={{ $('Telegram Trigger').item.json.message.chat.id }}","file":"={{ $('HTTP Request').item.json.url }}","additionalFields":{"caption":"={{ $('Edit Fields').item.json.judul }}"}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[2100,-140],"id":"b07b3d05-8ab0-4772-b2ec-c03e6c24f840","name":"Telegram3","webhookId":"d6e3cf19-b6f4-4d0b-993e-2b579f7093a4","credentials":{"telegramApi":{"id":"mqjjEBXk8igsBbUR","name":"Jarvis Bot"}}},{"parameters":{"content":"## Photo Input & Validation\nTerima foto makanan via Telegram, validate photo existence, dan route ke image processing atau request photo upload jika tidak ada image.","height":560,"width":400,"color":3},"type":"n8n-nodes-base.stickyNote","position":[-420,-320],"typeVersion":1,"id":"71f78576-b7cc-40c0-80c9-7f5972ca31ad","name":"Sticky Note"},{"parameters":{"content":"## Image Processing & AI Analysis\nDownload photo dari Telegram, resize image untuk optimization, dan analyze menggunakan OpenAI Vision untuk food identification dan nutrition calculation.","height":560,"width":500,"color":5},"type":"n8n-nodes-base.stickyNote","position":[20,-320],"typeVersion":1,"id":"bad82e27-287c-463c-80b8-24aa9297fd95","name":"Sticky Note1"},{"parameters":{"content":"## Data Processing & Formatting\nParse AI JSON output, format nutrition data untuk Telegram display, dan generate timestamp untuk nutrition tracking dengan proper date formatting.","height":560,"width":720,"color":5},"type":"n8n-nodes-base.stickyNote","position":[560,-320],"typeVersion":1,"id":"50c23266-3bb5-4a1c-ba19-535649a040a3","name":"Sticky Note2"},{"parameters":{"content":"## Chart Generation\nCreate nutrition pie chart dari parsed data, generate chart title dengan timestamp, dan convert to visual chart menggunakan QuickChart API.","height":560,"width":540,"color":5},"type":"n8n-nodes-base.stickyNote","position":[1320,-320],"typeVersion":1,"id":"f800cdf2-3fa4-47a6-8b1d-ea6ee25cc1ad","name":"Sticky Note3"},{"parameters":{"content":"## Nutrition Report Delivery\nSend detailed nutrition analysis via Telegram dengan formatted text, followed by nutrition chart image dengan proper caption untuk comprehensive food tracking.","height":560,"width":360,"color":4},"type":"n8n-nodes-base.stickyNote","position":[1900,-320],"typeVersion":1,"id":"0798096b-63bc-4653-9c3d-b708a152210c","name":"Sticky Note4"},{"parameters":{"content":"## Key Insight: Visual Nutrition Intelligence System\nWorkflow ini punya AI-Powered Photo-to-Nutrition Pipeline yang comprehensive:\n\nComputer Vision Analysis - OpenAI Vision identify food items dan estimate portions accurately\n\nRich Nutrition Data - Detailed breakdown protein, karbohidrat, lemak, vitamin, dan mineral\n\nVisual Analytics - Auto-generate pie chart untuk nutrition composition visualization\n\nHealth Insights - AI provide personalized health tips dan weekly intake trends","height":400,"width":360},"type":"n8n-nodes-base.stickyNote","position":[2360,-320],"typeVersion":1,"id":"5febd834-9dc3-437c-9029-49956d2ba848","name":"Sticky Note5"}],"connections":{"Telegram Trigger":{"main":[[{"node":"If","type":"main","index":0}]]},"If":{"main":[[{"node":"Telegram","type":"main","index":0}],[{"node":"Telegram1","type":"main","index":0}]]},"Telegram":{"main":[[{"node":"Edit Image","type":"main","index":0}]]},"Edit Image":{"main":[[{"node":"OpenAI","type":"main","index":0}]]},"OpenAI":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"Code1","type":"main","index":0}]]},"Code1":{"main":[[{"node":"Date & Time","type":"main","index":0}]]},"Code2":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"Date & Time":{"main":[[{"node":"Date & Time1","type":"main","index":0}]]},"Date & Time1":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Code2","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"Telegram2","type":"main","index":0}]]},"Telegram2":{"main":[[{"node":"Telegram3","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"Telegram Trigger":[{"json":{"update_id":719335889,"message":{"message_id":1209,"from":{"id":7833022593,"is_bot":false,"first_name":"Tim","username":"TimothyWijaya","language_code":"en"},"chat":{"id":7833022593,"first_name":"Tim","username":"TimothyWijaya","type":"private"},"date":1750753480,"photo":[{"file_id":"AgACAgUAAxkBAAIEuWhaYMiHuZXnq7sfffyZv--u017NAAJ5wjEb3XvZVquB20qJaS_jAQADAgADcwADNgQ","file_unique_id":"AQADecIxG9172VZ4","file_size":1863,"width":90,"height":70},{"file_id":"AgACAgUAAxkBAAIEuWhaYMiHuZXnq7sfffyZv--u017NAAJ5wjEb3XvZVquB20qJaS_jAQADAgADbQADNgQ","file_unique_id":"AQADecIxG9172VZy","file_size":26400,"width":320,"height":249},{"file_id":"AgACAgUAAxkBAAIEuWhaYMiHuZXnq7sfffyZv--u017NAAJ5wjEb3XvZVquB20qJaS_jAQADAgADeAADNgQ","file_unique_id":"AQADecIxG9172VZ9","file_size":118200,"width":800,"height":622},{"file_id":"AgACAgUAAxkBAAIEuWhaYMiHuZXnq7sfffyZv--u017NAAJ5wjEb3XvZVquB20qJaS_jAQADAgADeQADNgQ","file_unique_id":"AQADecIxG9172VZ-","file_size":180467,"width":1200,"height":933}]}}}]},"versionId":"79cb8bad-fbde-4c13-a6aa-e59557ad93a2","triggerCount":1,"tags":[]}
